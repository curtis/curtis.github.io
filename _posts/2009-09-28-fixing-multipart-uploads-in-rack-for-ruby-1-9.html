---
categories: [rails]
date: 2009-09-28 21:05:13
layout: post
redirect_from:
  - /programming/ruby-on-rails/fixing-multipart-uploads-in-rack-for-ruby-1-9/
subtitle: "Patch your Rack installation after seeing an 'invalid byte sequence in US-ASCII' error."
title: "Fixing Multipart Uploads in Rack for Ruby 1.9"
---
<p>There is a slight problem in Rack 1.0.0 that causes a fatal error to be produced when uploading files <= 110K in size. You may need to patch Rack if you see the following error when uploading a file (I saw it with Paperclip):</p>
<p><script src="https://gist.github.com/197155.js"></script></p>
<p><strong>Here's what you do to patch Rack:</strong></p>
<p><script src="https://gist.github.com/197215.js"></script></p>
<p>You should now be back in business. Hopefully it won't be too long before an update is released for Rack that includes the patch.</p>
<p>Happy uploading!</p>
<h3>References</h3>
<ul>
<li><a rel="external" href="https://rails.lighthouseapp.com/projects/8994/tickets/2497-rack-in-rails-232-throws-fatal-error-with-small-uploads">Rails Ticket #2497: Rack in Rails 2.3.2 throws fatal error with small uploads</a></li>
<li><a rel="external" href="http://github.com/rack/rack/commit/44ed4640f077504a49b7f1cabf8d6ad7a13f6441">Rack commit log: Fix multipart uploads on 1.9</a></li>
<li><a rel="external" href="http://rubynyc.wordpress.com/ruby-1-9-1/paperclip-triggering-a-invalid-byte-sequence-in-us-ascii/">Ruby NYC: paperclip triggering a “invalid byte sequence in US-ASCII” ruby 1.9 rails 2.3</a></li>
</ul>
